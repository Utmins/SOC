=====================================================================
* Руководство *
***************

Если использовать машину от HTB, то сперва надо запустить данную комнаду, чтобы скачать и распокавать все необходимые pcap файлы

	<usern_name>@<host_name>$ wget -O file.zip 'https://academy.hackthebox.com/storage/resources/pcap_files.zip' && mkdir tempdir && unzip file.zip -d tempdir && mkdir -p pcaps && mv tempdir/Intermediate_Network_Traffic_Analysis/* pcaps/ && rm -r tempdir file.zip

Удобнее всего просматривать PCAP-files используя Wireshark
Однако, в целях практики и выбработки навыков использования CLI-based tools мы будем использовать такие утилиты как tcpdump

=====================================================================
* Легенда *
***********

Борьба с rogue access points и evil-twin attacks может показаться колоссальной задачей из-за их часто неуловимой природы.
Тем не менее, при наличии соответствующих стратегий эти незаконные точки доступа можно обнаружить и эффективно контролировать.
В сфере злонамеренных точек доступа rogue access points и evil-twin attacks неизменно всплывают как существенные проблемы.

Rogue access points в первую очередь служит инструментом для обхода контроля периметра на месте.
Злоумышленник может установить такую ​​точку доступа, чтобы обойти сетевые средства контроля и барьеры сегментации, которые во многих случаях могут принимать форму точек доступа или привязанных соединений.
Известно, что rogue access points в air-gapped сети.
Их основная функция — предоставление несанкционированного доступа к ограниченным разделам сети.
Здесь важно помнить, что мошеннические точки доступа напрямую подключены к сети.

С другой стороны, evil-twin attacks раскручивается злоумышленником для множества других различных целей.
Ключевым моментом здесь является то, что в большинстве случаев эти точки доступа не подключены к нашей сети.
Вместо этого они являются автономными точками доступа, которые могут иметь веб-сервер или что-то еще, чтобы действовать как человек-посередине для беспроводных клиентов.
Злоумышленники могут настроить их для сбора паролей беспроводных сетей или доменов среди другой информации.
Обычно эти атаки могут также включать атаку на враждебный портал (hostile portal attack).

=====================================================================
* Подготовка *
**************

	+++++++++++++++++++++++++
	+ Airodump-ng Detection +
	+++++++++++++++++++++++++

	Сперва нам надо перечислить наши беспроводные интерфейсы в Linux с помощью следующей команды:
	***	Предположим, что у нас есть интерфейс Wi-Fi (хотя в действительности виртуальная машина HTB не располагает таким интерфейсом), способный работать в режиме монитора
		Поэтому, вывод на экране будет следующим

		<user_name>@<host_name>$ iwconfig

			wlan##:				IEEE 802.11
			ESSID:				off/any  
          		Mode:				Managed
			Access Point:			Not-Associated   
			Tx-Power=20 dBm   
          		Retry short  long limit		2
			RTS thr:			off
			Fragment thr:			off
          		Power Management:		off

	Затем определить какие беспроводные точки доступа существуют в радиусе действия нашего Wi-Fi интрефейса
	***	wlan## - это название нашено Wi-Fi интрейфейса

		<user_name>@<host_name>$ iwlist wlan## scan | grep ESSID

	Также можно использовать и различные скрипты (на просторах интеренета их много) для автоматического сканирования	

	Далее нам нужно использовать фильтр ESSID для Airodump-ng для обнаружения точек доступа в стиле Evil-Twin

		<usern_name>@<host_name>$ sudo airodump-ng -c 4 --essid <scanning_ESSID> wlan## -w raw

			BSSID              PWR 	RXQ  	Beacons		#Data, 	#/s  	CH   	MB   	ENC 	CIPHER  	AUTH 	ESSID
			F8:14:FE:4D:E6:F2   -7 	100     470      	155    	0   	4   	54   	OPN              		HTB-Wireless
			F8:14:FE:4D:E6:F1   -5  96      682        	0    	0   	4  	324  	WPA2 	CCMP   		PSK  	HTB-Wireless 
	
	Как видно из рзультата, злоумышленник мог бы развернуть открытую точку доступа с идентичным ESSID, как у нашей точки доступа.
	Злоумышленник может сделать это, чтобы провести то, что обычно называют атакой на враждебный портал.
	Атака на враждебный портал используется злоумышленниками для извлечения учетных данных пользователей среди других злонамеренных действий.

=====================================================================
* Анализ *
**********

	+++++++++++++++++++++++++
	+ Airodump-ng Detection +
	+++++++++++++++++++++++++

	Самое главное это то, что нам следует быть бдительны в отношении попыток деаутентификации, которые могут предполагать меры принудительного характера со стороны злоумышленника, управляющего точкой доступа-двойником-злодеем.

	Чтобы окончательно выяснить, является ли это аномалией или ошибкой Airodump-ng, мы можем начать наши усилия по анализу трафика.
	Чтобы отфильтровать кадры маяка, мы могли бы использовать следующий фильтр в Wireshark

		-	(wlan.fc.type == 00) and (wlan.fc.type_subtype == 8)

	Анализ маяков имеет решающее значение для различения подлинных и мошеннических точек доступа.
	Одной из первых отправных точек является информация о "надежной сети безопасности" (Robust Security Network - RSN).
	Эти данные передают клиентам ценную информацию о поддерживаемых шифрах, среди прочего.

	Предположим, мы хотим проверить информацию RSN нашей законной точки доступа (как правило первый кадр в отфильтрованном списке).

		Frame 1: 401 bytes on wire (3208 bits), 401 bytes captured (3208 bits)
    		IEEE 802.11 Beacon frame, Flags: ........
    		IEEE 802.11 Wireless Management
    			Fixed parameters (12 bytes)
        		Tagged parameters (365 bytes)
        			Tag: SSID parameter set: "HTB-Wireless"
            		        Tag: Supported Rates 1(B), 2(B), 5.5(B), 11(B), 9, 18, 36, 54, [Mbit/sec]
            		        Tag: DS Parameter set: Current Channel: 4
            		        Tag: Traffic Indication Map (TIM): DTIM 0 of 1 bitmap
            			Tag: Country Information: Country Code US, Environment All
            		        Tag: Power Constraint: 0
            		        Tag: TPC Report Transmit Power: 22, Link Margin: 0
            		        Tag: Tx Power Envelope
            		        Tag: RM Enabled Capabilities (5 octets)
            		        Tag: AP Channel Report: Operating Class 81, Channel List : 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,
           		        Tag: ERP Information
            		        Tag: Extended Supported Rates 6, 12, 24, 48, [Mbit/sec]
            		        Tag: RSN Information
            				Tag Number: RSN Information (48)
            				Tag length: 24
            				RSN Version: 1
            				Group Cipher Suite: 00:0f:ac (Ieee 802.11) TKIP
            				Pairwise Cipher Suite Count: 2
            				Pairwise Cipher Suite List 00:0f:ac (Ieee 802.11) TKIP 00:0f:ac (Ieee 802.11) AES (CCM)
            				Auth Key Management (AKM) Suite Count: 1
            				Auth Key Management (AKM) List 00:0f:ac (Ieee 802.11) PSK
            				RSN Capabilities: 0x0000
        			Tag: QBSS Load Element 802.11e CCA Version
			        Tag: HT Capabilities (802.11n D1.10)
            		        Tag: HT Information (802.11n D1.10)
            		        Tag: VHT Capabilities
            		        Tag: VHT Operation
            		        Tag: Extended Capabilities (11 octets)
            		        Tag: Vendor Specific: Microsoft Corp.: WMM/WME: Parameter Element
            		        Ext Tag: HE Capabilities
            		        Ext Tag: HE Operation
            		        Ext Tag: Spatial Reuse Parameter Set
            		        Ext Tag: MU EDCA Parameter Set
            		        Tag: Vendor Specific: Ralink Technology, Corp.
            		        Tag: Vendor Specific: MediaTek Inc.
            		        Tag: Vendor Specific: MediaTek Inc.
            		        Tag: FILS Indication

	Результат показывает, что WPA2 поддерживается с AES и TKIP с PSK в качестве механизма аутентификации.
	Однако, когда мы переключимся на информацию RSN незаконных точек доступа, мы можем обнаружить, что она явно отсутствует (как правило это второй кадр в отфильтрованном списке).
            
		Frame 30: 78 bytes on wire (624 bits), 78 bytes captured (624 bits)
		IEEE 802.11 Beacon frame, Flags: ........
		IEEE 802.11 Wireless Management
    			Fixed parameters (12 bytes)
    			Tagged parameters (42 bytes)
        			Tag: SSID parameter set: "HTB-Wireless"
            		        Tag: Supported Rates 1(B), 2(B), 5.5(B), 11(B), 6, 9, 12, 18, [Mbit/sec]
            		        Tag: DS Parameter set: Current Channel: 4
            		        Tag: Traffic Indication Map (TIM): DTIM 0 of 1 bitmap
            		        Tag: ERP Information
            		        Tag: Extended Supported Rates 24, 36, 48, 54, [Mbit/sec]

	В большинстве случаев evil-twin attack будет демонстрировать эту характеристику.
	Тем не менее, мы всегда должны проверять дополнительные поля на предмет несоответствий, особенно при работе с более сложными evil-twin attack.
	Например, злоумышленник может использовать тот же шифр, что и наша точка доступа, что усложнит обнаружение этой атаки.

	При таких обстоятельствах мы могли бы изучить другие аспекты кадра маяка, такие как vendor-specific information, которая, вероятно, отсутствует в точке доступа злоумышленника.

	
	+++++++++++++++++++++++++
	+ Finding a Fallen User +
	+++++++++++++++++++++++++

	Несмотря на всестороннее обучение по вопросам безопасности, некоторые пользователи могут стать жертвами таких атак.
	К счастью, в случае атак типа «evil-twin» в открытом сетевом стиле мы можем просматривать большую часть трафика более высокого уровня в незашифрованном формате.
	Чтобы отфильтровать исключительно точку доступа «evil-twin», мы бы использовали следующий фильтр.

		-	(wlan.bssid == ##:##:##:##:##:##)

	Если мы обнаружим ARP-запросы, исходящие от клиентского устройства, подключенного к подозрительной сети, мы идентифицируем это как потенциальный индикатор компрометации.
	В таких случаях мы должны записать соответствующие данные о клиентском устройстве для дальнейших усилий по реагированию на инциденты.

		i)	Его MAC-адрес
		ii)	Его имя хоста

	Следовательно, мы можем инициировать сброс пароля и другие ответные меры для предотвращения дальнейшего нарушения нашей среды.

	+++++++++++++++++++++++++++++++
	+ Finding Rogue Access Points +
	+++++++++++++++++++++++++++++++

	С другой стороны, обнаружение rogue access points часто может быть простой задачей проверки списков сетевых устройств.
	В случае hotspot-based rogue access points (например, точек доступа Windows) мы можем тщательно изучить беспроводные сети в непосредственной близости.
	Если мы сталкиваемся с нераспознаваемой беспроводной сетью с сильным сигналом, особенно если в ней отсутствует шифрование, это может означать, что пользователь установил мошенническую точку доступа для обхода наших периметральных элементов управления.
 

=====================================================================
* Дополнительные Вопросы *
**************************

	Введите MAC-адрес жертвы атаки Evil Twin

		-	(wlan.bssid == ##:##:##:##:##:##) && arp

=====================================================================
* Руководство *
***************

Если использовать машину от HTB, то сперва надо запустить данную комнаду, чтобы скачать и распокавать все необходимые pcap файлы

	<usern_name>@<host_name>$ wget -O file.zip 'https://academy.hackthebox.com/storage/resources/pcap_files.zip' && mkdir tempdir && unzip file.zip -d tempdir && mkdir -p pcaps && mv tempdir/Intermediate_Network_Traffic_Analysis/* pcaps/ && rm -r tempdir file.zip

Удобнее всего просматривать PCAP-files используя Wireshark
Однако, в целях практики и выбработки навыков использования CLI-based tools мы будем использовать такие утилиты как tcpdump

=====================================================================
* Легенда *
***********

Очень часто Вы будете наблюдать нерегулярный трафик для пакетов IPv4 и IPv6.
Во многих таких случаях это может быть сделано через поля source and destination IP.
Мы всегда должны учитывать следующее при анализе этих полей для наших усилий по анализу трафика.

	1)	Исходный IP-адрес всегда должен быть из нашей подсети.
		Если мы замечаем, что входящий пакет имеет исходный IP-адрес за пределами нашей локальной сети, это может быть признаком создания пакетов.

	2)	Исходный IP-адрес для исходящего трафика всегда должен быть из нашей подсети.
		Если исходный IP-адрес находится в другом диапазоне IP-адресов, чем наша локальная сеть, это может быть признаком вредоносного трафика, который исходит изнутри нашей сети.

Злоумышленник может проводить эти атаки по созданию пакетов в направлении source and destination IP-адресов по разным причинам или для достижения желаемых результатов.
Вот несколько из них, которые мы можем искать:

	i)		Decoy Scanning (Ложное сканирование)
			В попытке обойти ограничения брандмауэра злоумышленник может изменить исходный IP-адрес пакетов, чтобы получить дополнительную информацию о хосте в другом сегменте сети.
			Изменив источник на что-то в той же подсети, что и целевой хост, злоумышленник может успешно обойти брандмауэр.

	ii)		DDoS-атака случайного источника.
			С помощью случайного создания источника злоумышленник может отправить тонны трафика на тот же порт на хосте жертвы.
			Во многих случаях это используется для истощения ресурсов наших сетевых элементов управления или на целевом хосте.

	iii)	Атаки LAND.
			Атаки LAND работают аналогично атакам типа «отказ в обслуживании» случайного источника, поскольку исходный адрес устанавливается таким же, как и на целевых хостах.
			При этом злоумышленник может исчерпать сетевые ресурсы или вызвать сбои на целевом хосте.

	iv)		Атаки SMURF.
			Подобно атакам LAND и случайным источникам, атаки SMURF работают, когда злоумышленник отправляет большое количество ICMP-пакетов на множество различных хостов.
			Однако в этом случае исходный адрес устанавливается на машины жертвы, и все хосты, которые получают этот ICMP-пакет, отвечают ответом ICMP, вызывая истощение ресурсов на созданном исходном адресе (жертве).

	v)		Initialization Vector Generation
			В старых беспроводных сетях, таких как wired equivalent privacy, злоумышленник может захватить, расшифровать, создать и повторно ввести пакет с измененным исходным и целевым IP-адресом, чтобы сгенерировать векторы инициализации для построения таблицы дешифрования для статистической атаки.
			Их можно увидеть, заметив чрезмерное количество повторяющихся пакетов между хостами.

Важно отметить, что в отличие от отравления ARP, атаки, которые мы рассмотрим в этом разделе, происходят из коммуникаций уровня IP, а не обязательно отравления ARP.
Однако эти атаки, как правило, проводятся в тандеме

=====================================================================
* Подготовка *
**************

Но при помощи следующих способов мы можем предотвратить подобные атаки, помимо простого ее обнаружения с помощью наших усилий по анализу трафика, заключается в следующем.

	1)	Пусть наши IDS/IPS/брандмауэр будут действовать как целевой хост - в том смысле, что реконструкция пакетов дает четкое указание на вредоносную активность.

	2)	Следите за соединениями, запущенными одним хостом и перехваченными другим - в конце концов, злоумышленник должен раскрыть свой истинный исходный адрес, чтобы увидеть, что порт открыт.
		Это странное поведение, и мы можем определить наши правила, чтобы предотвратить его.

=====================================================================
* Анализ *
**********

	+++++++++++++++++++++++++++++++++++
	+ Finding Decoy Scanning Attempts +
	+++++++++++++++++++++++++++++++++++

	Более того, когда злоумышленник хочет собрать информацию, он может изменить свой исходный адрес, чтобы он совпадал с адресом другого законного хоста или, в некоторых случаях, полностью отличался от любого реального хоста.
	Это делается для того, чтобы обойти контроль IDS/брандмауэра, и это можно легко заметить.

	В случае Decoy Scanning мы можем заметить странное поведение:

		-	Начальная фрагментация с поддельного адреса
		-	Дубликация TCP пакетов с одного законного адреса, но на разные порты
		-	Большое колчество пакетов адресованых в/с закрытых портов

	Также, злоумышленник может попытаться скрыть свой адрес с помощью приманки (ложного адреса), но ответы для нескольких закрытых портов все равно будут направлены ему с флагами RST, обозначенными для TCP.

	+++++++++++++++++++++++++++++++++
	+ Finding Random Source Attacks +
	+++++++++++++++++++++++++++++++++

	Для обнаружения атак типа «отказ в обслуживании» необходимо тщательно анализировать адреса источника и назначения на предмет подмены.
	
	Одним из основных и примечательных примеров являются атаки случайного источника.
	Они могут проводиться во многих различных вариантах.
	Однако, что примечательно, это может быть сделано как противоположность атаке SMURF, в которой многие хосты будут пинговать один хост, который не существует, а пингуемый хост будет пинговать все остальные и не получит ответа.

	Мы также должны учитывать, что злоумышленники могут фрагментировать эти случайные сообщения хостов, чтобы еще больше истощить ресурсы.

	Однако во многих случаях, например, атаках LAND, эти атаки будут использоваться злоумышленниками для истощения ресурсов одной конкретной службы на порту.
	Вместо того, чтобы подделывать исходный адрес, чтобы он совпадал с адресом назначения, злоумышленник может рандомизировать их.
	В этом случае у нас есть несколько индикаторов неблаговидного поведения:

		-	Использование одного порта случайными хостами
		-	Постепенное и упорядоченное увеличение значения порта вместо использования рандомизации
		-	Идентичные значения заголовка(-ов) Length

	Во многих реальных случаях, таких как веб-сервер, у нас может быть много разных пользователей, использующих один и тот же порт.
	Однако эти запросы будут отличаться от того, что мы ищем.
	К примеру они будут иметь разную длину, и базовые порты не будут демонстрировать такое поведение

	+++++++++++++++++++++++++
	+ Finding Smurf Attacks +
	+++++++++++++++++++++++++

	Атаки SMURF — это известная распределенная атака типа «отказ в обслуживании», которая по своей природе работает, заставляя случайные хосты отправлять пинг хосту-жертве.
	Проще говоря, злоумышленник выполняет их следующим образом:

		1)	Злоумышленник отправляет ICMP-запрос на живые хосты с поддельным адресом хоста-жертвы

		2)	Живые хосты отвечают законному хосту-жертве ICMP-ответом

		3)	Это может привести к истощению ресурсов на хосте-жертве

	Одной из вещей, на которые мы можем обратить внимание в поведении трафика при такое атаке, является чрезмерное количество ответов ICMP от одного хоста к хосту-жертве.
	Иногда злоумышленники включают фрагментацию и данные в эти запросы ICMP, чтобы увеличить объем трафика.

	Мы можем заметить, что множество разных хостов пингуют единственный хост, и в этом случае это отражает основную природу атак SMURF.

	++++++++++++++++++++++++
	+ Finding LAND Attacks +
	++++++++++++++++++++++++

	Атаки LAND осуществляются посредством подмены злоумышленником исходного IP-адреса таким же, как и у получателя.
	Эти атаки типа «отказ в обслуживании» работают через огромный объем трафика и повторное использование портов.
	По сути, если все базовые порты заняты, это значительно затрудняет установление реальных подключений к нашему затронутому хосту.
	Проще говоря, жертва пингует сама себя, но по разным портам

=====================================================================
* Дополнительные Вопросы *
**************************

	Опредлеите общее количество пакетов, имеющих флаг TCP RST

		-	tcp.flags.reset==1

Теперь, когда мы знакомы с киберцепочкой и её этапами, мы можем лучше прогнозировать/предвидеть последующие шаги атаки, а также предлагать соответствующие меры противодействия.

Как и в киберцепочке, существуют различные этапы реагирования на инцидент, определяемые как процесс обработки инцидентов.
Процесс обработки инцидентов определяет способность организаций готовиться, обнаруживать и реагировать на вредоносные события.
Обратите внимание, что этот процесс подходит для реагирования на события, связанные с ИТ-безопасностью, но его этапы не соответствуют этапам киберцепочки однозначно.

Согласно определению NIST, процесс обработки инцидентов состоит из следующих четырёх (4) отдельных этапов:

                                    ---------------------   
                                    |                   |
                                    |                  \/
                            -------------       -----------------       -----------------
    -----------------       | Detection |       | Containment   |       | Post-Incident |
    | Preparation   |------>|     &     |       | Eradicatoin   |------>| Activity      |
    -----------------       |  Analysis |       | & Recovery    |       -----------------
           /\               -------------       -----------------               |
            |                      /\                   |                       |
            |                       |                   |                       |
            |                       ---------------------                       |
            |                                                                   |
            ---------------------------------------------------------------------

Специалисты по обработке инцидентов тратят большую часть своего времени на первые два этапа: подготовку и обнаружение и анализ.
Именно здесь мы уделяем много времени самосовершенствованию и поиску следующего вредоносного события.
При обнаружении вредоносного события мы переходим к следующему этапу и реагируем на него (но на первых двух этапах всегда должны быть задействованы ресурсы, чтобы не прерывать подготовку и обнаружение).

Как видно на схеме, этот процесс не линейный, а циклический.
Важно понимать, что по мере обнаружения новых доказательств последующие шаги также могут меняться.
Крайне важно не пропускать этапы процесса и завершать один этап перед переходом к следующему.
Например, если вы обнаружили десять зараженных машин, ни в коем случае не следует сразу же изолировать только пять из них и начинать уничтожение, пока остальные пять остаются в зараженном состоянии.
Такой подход может быть неэффективным, поскольку, как минимум, вы уведомляете злоумышленника о его обнаружении и о том, что выслеживаете его, что, как вы можете себе представить, может иметь непредсказуемые последствия.

Итак, обработка инцидента включает два основных этапа:

    -   Расследование
        Целью расследования является:

            -   Выявление первоначальной жертвы (нулевого пациента) и создание (текущей, если она ещё активна) временной шкалы инцидента;
            -   Определение инструментов и вредоносного ПО, использованных злоумышленником;
            -   Документирование скомпрометированных систем и действий злоумышленника.
    
    -   Восстановление
        После расследования процесс восстановления включает в себя разработку и реализацию плана восстановления. 

После реализации плана компания должна возобновить нормальную работу, если инцидент вызвал какие-либо сбои.

После полного устранения инцидента составляется отчёт с подробным описанием причины и стоимости инцидента.
Кроме того, помимо прочего, проводятся мероприятия по извлечению уроков, чтобы понять, какие действия организации следует предпринять для предотвращения повторения инцидентов подобного типа.

=====================================================================
* Preparation *
***************

На этапе подготовки мы преследуем две отдельные цели.

    1)  Создание возможностей для обработки инцидентов в организации (establishment of incident handling capability)
    2)  Способность защищаться от инцидентов и предотвращать их путём внедрения соответствующих мер безопасности (ability to protect against and prevent IT security incidents)
        К таким мерам относятся:
        
            -   усиление защиты конечных точек и серверов
            -   многоуровневое хранение данных в Active Directory
            -   многофакторная аутентификация
            -   управление привилегированным доступом и т. д.

Хотя защита от инцидентов не входит в обязанности группы по обработке инцидентов, эта деятельность имеет основополагающее значение для общего успеха этой группы.

    +++++++++++++++++++++++++++++++++++++++++++++++++
    + Establishment of incident handling capability +
    +++++++++++++++++++++++++++++++++++++++++++++++++

        /////////////////////////////////
        /// Preparation Prerequisites ///
        /////////////////////////////////

        В ходе подготовки нам необходимо обеспечить наличие:

            -   Квалифицированных членов команды по обработке инцидентов 
                Членов команды по обработке инцидентов можно привлечь к работе со сторонними организациями, но в любом случае базовые навыки и понимание процесса обработки инцидентов необходимы для работы внутри компании

            -   Обученного персонала (насколько это возможно) посредством мероприятий по повышению осведомленности в области безопасности или других методов обучения

            -   Четких политик и документации;

            -   Инструментов (программного и аппаратного обеспечения)

        //////////////////////////////////////
        /// Clear Policies & Documentation ///
        //////////////////////////////////////

        Некоторые из письменных политик и документации должны содержать актуальную версию следующей информации:

            -   Контактная информация и роли членов команды по обработке инцидентов
            -   Контактная информация юридического отдела и отдела по обеспечению соответствия, руководства, ИТ-поддержки, отдела по связям со СМИ, правоохранительных органов, интернет-провайдеров, администрации объекта и внешней группы реагирования на инциденты
            -   Политика, план и процедуры реагирования на инциденты
            -   Политика и процедуры обмена информацией об инцидентах
            -   Базовые характеристики систем и сетей, основанные на эталонном образе и чистой среде
            -   Схемы сетей
            -   База данных управления активами организации
            -   Учетные записи пользователей с избыточными привилегиями, которые могут быть использованы командой по требованию при необходимости 
                В том числе для критически важных для бизнеса систем, которые обслуживаются с использованием навыков, необходимых для администрирования данной конкретной системы.
                Эти учетные записи пользователей обычно активируются при подтверждении инцидента в ходе первоначального расследования и затем деактивируются после его завершения.
                При деактивации учетных записей пользователей также выполняется обязательный сброс пароля.
            -   Возможность приобретения оборудования, программного обеспечения или внешнего ресурса без полной процедуры закупки (срочная закупка определенного количества).
                Последнее, что вам нужно во время инцидента, — это неделями ждать одобрения инструмента за 500 долларов.
            -   Шпаргалки по криминалистике/расследованию
        
        Некоторые несерьёзные случаи могут быть рассмотрены относительно быстро и без особых проблем внутри организации или за её пределами.
        В других случаях может потребоваться уведомление правоохранительных органов и внешняя связь с клиентами и сторонними поставщиками, особенно в случаях, когда инцидент вызывает юридические вопросы.
        Например, в соответствии с GDPR, об утечке данных, затрагивающей данные клиентов, необходимо сообщить правоохранительным органам в течение определённого срока.
        В зависимости от местоположения и/или филиалов, где произошёл инцидент, может существовать множество требований к соблюдению нормативных требований, поэтому лучший способ понять их — обсудить их с вашими юридическими и комплаенс-отделами по каждому инциденту (или проактивно).

        Хотя наличие документации крайне важно, также важно документировать инцидент в ходе расследования.
        Поэтому на этом этапе вам также необходимо создать эффективный механизм подачи сообщений.
        Инциденты могут быть чрезвычайно стрессовыми, и об этом легко забыть по мере развития инцидента, особенно когда вы сосредоточены и действуете очень быстро, чтобы решить его как можно скорее.
        Постарайтесь сохранять спокойствие, делайте заметки и убедитесь, что в них указаны время, характер выполненного действия, его результат и кто это сделал.
        В целом, вам следует искать ответы на вопросы:
        
            -   кто
            -   что
            -   когда
            -   где
            -   почему
            -   как

        ///////////////////////////////////
        /// Tools (Software & Hardware) ///
        ///////////////////////////////////

        В дальнейшем нам также необходимо обеспечить наличие необходимых инструментов для выполнения работы.
        К ним относятся, помимо прочего:

            -   Дополнительный ноутбук или рабочая станция для каждого члена команды по работе с инцидентами, чтобы сохранять образы дисков и файлы журналов, выполнять анализ данных и проводить расследования без каких-либо ограничений
                Так как возможно удет проводиться тестирование вредоносного ПО, поэтому такие инструменты, как антивирус, следует отключить.
                С этими устройствами следует обращаться надлежащим образом, не подвергая организацию рискам.
            -   Инструменты для получения и анализа цифровых криминалистических изображений
            -   Инструменты для захвата и анализа памяти
            -   Сбор и анализ данных в режиме реального времени
            -   Инструменты для анализа журналов
            -   Инструменты для захвата и анализа сети
            -   Сетевые кабели и коммутаторы
            -   Блокировщики записи
            -   Жесткие диски для криминалистического получения изображений
            -   Кабели питания
            -   Отвертки, пинцеты и другие необходимые инструменты для ремонта или разборки оборудования при необходимости
            -   Создание индикаторов компрометации (IOC) и возможность поиска IOC по всей организации
            -   Формы для передачи оборудования на хранение (временное и/или постоянное)
            -   Программное обеспечение для шифрования
            -   Система отслеживания тикетов
            -   Защищенное хранилище для хранения и расследования
            -   Система обработки инцидентов, независимая от инфраструктуры вашей организации
        
        Многие из упомянутых выше инструментов входят в так называемый «jump bag» — всегда готовый к немедленному использованию набор инструментов.
        Без этого подготовленного набора сбор всех необходимых инструментов на ходу может занять несколько дней или недель, прежде чем вы будете готовы к реагированию.

        Наконец, стоит подчеркнуть важность полной независимости вашей системы документации от инфраструктуры вашей организации и её надёжной защиты.
        С самого начала предполагайте, что весь ваш домен скомпрометирован, и все системы могут стать недоступными.
        Аналогичным образом, сообщения об инциденте следует передавать по каналам, не являющимся частью систем организации
        Предполагайте, что злоумышленники контролируют всё и могут читать каналы связи, такие как электронная почта.

    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    + Аbility to protect against and prevent IT security incidents +
    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

    Другая часть подготовительного этапа — защита от инцидентов.
    Хотя защита не обязательно входит в обязанности группы по обработке инцидентов, любые действия, связанные с защитой, должны быть ей известны, чтобы лучше понимать тип и сложность инцидента, а также знать, где искать артефакты/доказательства, которые могут помочь в расследовании.

    Давайте рассмотрим некоторые из настоятельно рекомендуемых мер защиты, которые обеспечивают высокий уровень смягчения последствий большинства угроз.

        /////////////
        /// DMARC ///
        /////////////

        DMARC — это защита электронной почты от фишинга, построенная на основе уже существующих SPF и DKIM.
        Идея DMARC заключается в отклонении писем, которые «выдают себя» за письма, отправленные вашей организацией.
        Поэтому, если злоумышленник подделывает письмо от имени сотрудника с просьбой оплатить счёт, система отклонит его до того, как оно достигнет получателя.
        DMARC прост и недорог в реализации, однако я не могу не подчеркнуть, что тщательное тестирование обязательно; в противном случае (и это часто случается) вы рискуете заблокировать легитимные письма без возможности их восстановления.

        С помощью правил фильтрации электронной почты вы можете вывести DMARC на «новый» уровень и применить дополнительную защиту от писем, не прошедших проверку DMARC, с доменов, которым вы не владеете.
        Это возможно, поскольку некоторые почтовые системы выполняют проверку DMARC и включают заголовок, сообщающий о прохождении или непрохождении DMARC, в заголовки сообщений.
        Хотя этот метод может быть невероятно эффективным для обнаружения фишинговых писем с любого домена, перед его внедрением в рабочую среду требуется тщательное тестирование.
        Высокий процент ложноположительных срабатываний здесь приходится на письма, отправленные «от имени» какого-либо сервиса электронной почты, поскольку они, как правило, не проходят проверку DMARC из-за несоответствия домена.

        //////////////////////////////////
        /// Endpoint Hardening (& EDR) ///
        //////////////////////////////////

        Конечные устройства (рабочие станции, ноутбуки и т. д.) являются точками входа для большинства атак, с которыми мы сталкиваемся ежедневно.
        Учитывая, что большинство угроз исходит из Интернета и нацелено на пользователей, просматривающих веб-сайты, открывающих вложения или запускающих вредоносные исполняемые файлы, определённая часть этой активности будет исходить с корпоративных конечных устройств.

        В настоящее время существует несколько общепризнанных стандартов защиты конечных точек, среди которых наиболее популярны базовые стандарты CIS и Microsoft, и они действительно должны стать основой для базовых стандартов защиты вашей организации.
        Вот несколько важных действий (которые действительно работают), которые стоит принять во внимание и предпринять:

            -   Отключение LLMNR/NetBIOS
            -   Внедрение LAPS и лишение прав администратора обычных пользователей
            -   Отключение или настройка PowerShell в режиме «ConstrainedLanguage»
            -   Включение правил Attack Surface Reduction (ASR) при использовании Microsoft Defender
            -   Внедрение белых списков.
                Мы знаем, что это практически невозможно реализовать.
                Рассмотрите возможность блокировки запуска как минимум из папок, доступных для записи пользователем (Загрузки, Рабочий стол, AppData и т. д.).
                Именно в этих местах изначально обнаруживаются эксплойты и вредоносные компоненты.
                Не забудьте также заблокировать такие типы скриптов, как .hta, .vbs, .cmd, .bat, .js и аналогичные.
                При реализации белых списков обратите внимание на файлы LOLBin.
                Не упускайте их из виду; они часто используются в качестве начального доступа для обхода белых списков.
            -   Используйте межсетевые экраны на хосте.
                Как минимум, заблокируйте взаимодействие между рабочими станциями и исходящий трафик к LOLBin.
            -   Разверните продукт EDR.
                На данный момент AMSI обеспечивает отличную видимость обфусцированных скриптов для антивирусных продуктов, позволяя им проверять содержимое перед выполнением.
                Настоятельно рекомендуется выбирать только продукты, интегрированные с AMSI.

        Когда дело доходит до защиты, не позволяйте лучшему быть врагом хорошего.

        //////////////////////////
        /// Network Protection ///
        //////////////////////////

        Сегментация сети — эффективный метод предотвращения распространения взлома на всю организацию.
        Критически важные для бизнеса системы должны быть изолированы, а подключения должны быть разрешены только в соответствии с требованиями бизнеса.
        Внутренние ресурсы не должны иметь прямого доступа к Интернету (за исключением случаев размещения в демилитаризованной зоне).

        Кроме того, говоря о сетевой защите, следует учитывать системы IDS/IPS.
        Их потенциал особенно очевиден при перехвате SSL/TLS, что позволяет идентифицировать вредоносный трафик по содержимому сети, а не по репутации IP-адресов, что является традиционным и крайне неэффективным способом обнаружения вредоносного трафика.

        Кроме того, убедитесь, что к сети могут подключаться только устройства, одобренные организацией.
        Такие решения, как 802.1x, можно использовать для снижения риска использования собственных устройств (BYOD) или подключения вредоносных устройств к корпоративной сети.
        Если ваша компания использует только облачные технологии и, например, Azure/Azure AD, вы можете добиться аналогичной защиты с помощью политик условного доступа, которые разрешат доступ к ресурсам организации только при подключении с устройства, управляемого компанией.

        ///////////////////////////////////////////////////////
        /// Privilege Identity Management / MFA / Passwords ///
        ///////////////////////////////////////////////////////

        На данный момент кража учётных данных привилегированных пользователей является наиболее распространённым способом эскалации в средах Active Directory.
        Кроме того, распространённой ошибкой является использование администраторами либо слабого (но часто сложного) пароля, либо пароля, общего с их учётной записью обычного пользователя (что можно получить с помощью различных векторов атак, таких как кейлоггерство).
        Например, слабое, но сложное правило — «Password1!». Оно включает в себя заглавные и строчные буквы, цифры и специальные символы, но, несмотря на это, его легко предсказать, и его можно найти во многих списках паролей, используемых злоумышленниками в своих атаках.
        Рекомендуется научить сотрудников использовать парольные фразы, поскольку их сложнее угадать и подобрать методом перебора.
        Примером легко запоминающейся, но длинной и сложной парольной фразы является «i LIK3 my coffeE warm».
        Если вы знаете второй язык, вы можете смешивать слова из разных языков для дополнительной защиты.

        Многофакторная аутентификация (MFA) — ещё одно решение для защиты персональных данных, которое следует внедрить как минимум для любого типа административного доступа ко ВСЕМ приложениям и устройствам.

        //////////////////////////////
        /// Vulnerability Scanning ///
        //////////////////////////////

        Проводите постоянное сканирование вашей среды на наличие уязвимостей и устраняйте как минимум «высокие» и «критические» обнаруженные уязвимости.
        Хотя сканирование можно автоматизировать, исправления обычно требуют ручного вмешательства.
        Если по какой-то причине вы не можете установить исправления, обязательно сегментируйте уязвимые системы!

        ///////////////////////////////
        /// User Awareness Training ///
        ///////////////////////////////

        Обучение пользователей распознавать подозрительное поведение и сообщать о нём при его обнаружении — это большая победа для нас.
        Хотя вряд ли удастся достичь 100% успеха в решении этой задачи, известно, что такое обучение значительно снижает количество успешных взломов.
        Периодическое «внезапное» тестирование также должно быть частью этого обучения, включая, например, ежемесячные фишинговые письма, забытые USB-накопители в офисном здании и т. д.

        ////////////////////////////////////////////
        /// Active Directory Security Assessment ///
        ////////////////////////////////////////////

        Лучший способ обнаружить ошибки в настройках безопасности или выявленные критические уязвимости — взглянуть на них с точки зрения злоумышленника.
        Проведение собственных проверок (или привлечение стороннего специалиста, если в организации отсутствуют необходимые навыки) гарантирует, что при компрометации конечного устройства злоумышленник не сможет в один шаг повысить свои привилегии до высоких в сети.
        Чем больше дополнительных инструментов и действий использует злоумышленник, тем выше вероятность его обнаружения, поэтому старайтесь максимально исключить лёгкие и несложные решения.

        В Active Directory есть несколько известных и уникальных путей эскалации/ошибок.
        Новые также обнаруживаются довольно часто.
        Оценка безопасности Active Directory критически важна для состояния безопасности среды в целом.
        Не думайте, что ваши системные администраторы знают обо всех обнаруженных или опубликованных ошибках, поскольку на самом деле это, вероятно, не так.

        /////////////////////////////
        /// Purple Team Exercises ///
        /////////////////////////////

        Нам необходимо обучать специалистов по работе с инцидентами и поддерживать их вовлеченность.
        В этом нет никаких сомнений, и лучшее место для этого — внутренняя среда организации.
        Учения Purple Team — это, по сути, оценка безопасности, проводимая красной командой, которая либо постоянно, либо периодически информирует синюю команду о своих действиях, результатах, любых недостатках в плане видимости/безопасности и т. д.
        Такие учения помогут выявить уязвимости в организации, одновременно проверяя обороноспособность синей команды с точки зрения регистрации, мониторинга, обнаружения и реагирования.
        Если угроза остаётся незамеченной, появляется возможность её улучшить.
        В случае обнаружения угроз синяя команда может протестировать любые стратегии и процедуры обработки инцидентов, чтобы убедиться в их надёжности и достижении ожидаемого результата.

=====================================================================
* Detection & Analysis *
************************

Этап обнаружения и анализа охватывает все аспекты обнаружения инцидента, такие как использование датчиков, журналов и обученного персонала.
Он также включает обмен информацией и знаниями, а также использование контекстной аналитики угроз.
Сегментация архитектуры и четкое понимание и прозрачность сети также являются важными факторами.

Угрозы проникают в организацию через бесконечное количество векторов атак, и их обнаружение может осуществляться из таких источников, как:

    -   Сотрудник, заметивший ненормальное поведение
    -   Оповещение от одного из наших инструментов (EDR, IDS, межсетевой экран, SIEM и т. д.)
    -   Мероприятия по выявлению угроз
    -   Уведомление от третьей стороны об обнаружении признаков компрометации нашей организации

Настоятельно рекомендуется создать уровни обнаружения, логически классифицируя нашу сеть следующим образом.

    -   Обнаружение на периметре сети (с использованием межсетевых экранов, систем обнаружения/предотвращения вторжений в сети с выходом в Интернет, демилитаризованной зоны и т. д.)
    -   Обнаружение на уровне внутренней сети (с использованием локальных межсетевых экранов, систем обнаружения/предотвращения вторжений на хост и т. д.)
    -   Обнаружение на уровне конечных точек (с использованием антивирусных систем, систем обнаружения и реагирования на конечные точки и т. д.)
    -   Обнаружение на уровне приложений (с использованием журналов приложений, журналов служб и т. д.)

    +++++++++++++++++++++++++
    + Initial Investigation +
    +++++++++++++++++++++++++

    При обнаружении инцидента безопасности следует провести предварительное расследование и установить контекст, прежде чем собирать команду и запускать общеорганизационную группу реагирования.
    Представьте, как отображается информация в случае подключения административной учётной записи к IP-адресу в формате ЧЧ:ММ:СС.
    Не зная, какая система находится на этом IP-адресе и к какому часовому поясу относится время, мы можем легко прийти к неверному выводу о сути инцидента.
    Подводя итог, на данном этапе следует стремиться собрать как можно больше информации по следующим вопросам:

        -   Дата/время сообщения об инциденте. Кроме того, кто обнаружил инцидент и/или сообщил о нём?
        -   Как был обнаружен инцидент?
        -   Что это был за инцидент? Фишинг? Недоступность системы? и т. д.
        -   Составьте список затронутых систем (если применимо).
        -   Задокументируйте, кто получал доступ к затронутым системам и какие меры были приняты.
            Отметьте, продолжается ли инцидент или подозрительная активность была остановлена.
        -   Физическое местоположение, операционные системы, IP-адреса и имена хостов, владелец системы, назначение системы, текущее состояние системы.
        -   Если задействовано вредоносное ПО, то список IP-адресов, время и дата обнаружения, тип вредоносного ПО, затронутые системы, экспорт вредоносных файлов с криминалистической информацией (например, хэшами, копиями файлов и т. д.).

    Имея эту информацию, мы можем принимать решения на основе собранных знаний.
    Что это значит? 
    Мы, вероятно, предприняли бы другие действия, если бы знали, что ноутбук генерального директора был взломан, а не ноутбук стажера.

    На основе первоначально собранной информации мы можем начать строить временную шкалу инцидента.
    Эта временная шкала поможет нам организовать всё событие и предоставит общую картину произошедшего.
    События на временной шкале отсортированы по времени их возникновения.
    Обратите внимание, что в ходе дальнейшего расследования мы не обязательно обнаружим доказательства в таком порядке.
    Однако, сортируя доказательства по времени их возникновения, мы получаем контекст отдельных событий, которые имели место.
    Хронология также может пролить свет на то, являются ли вновь обнаруженные доказательства частью текущего инцидента.
    Например, представьте, что то, что мы считали исходной полезной нагрузкой атаки, позже было обнаружено на другом устройстве две недели назад.
    Мы столкнемся с ситуациями, когда рассматриваемые нами данные крайне релевантны, и ситуациями, когда данные не связаны между собой, и мы ищем не там.
    В целом, временная шкала должна содержать информацию, описанную в следующих столбцах:

        Date	        Time of the event	    hostname	    event description	                    data source
        09/09/2021	    13:31 CET	            SQLServer01	    Hacker tool 'Mimikatz' was detected     Antivirus Software
    
    Как вы можете заключить, временная шкала в первую очередь фокусируется на поведении злоумышленника, поэтому зафиксированные действия отображают:
    
        -   время совершения атаки
        -   время установления сетевого соединения для доступа к системе
        -   время загрузки файлов
        -   и т. д.
    
    Важно убедиться, что вы фиксируете, откуда была обнаружена/зафиксирована активность, а также связанные с ней системы.

    ++++++++++++++++++++++++++++++++++++++++
    + Incident Severity & Extent Questions +
    ++++++++++++++++++++++++++++++++++++++++

    При обработке инцидента безопасности следует также попытаться ответить на следующие вопросы, чтобы получить представление о его серьёзности и масштабе:

        -   Каковы последствия эксплуатации?
        -   Каковы требования к эксплуатации?
        -   Может ли инцидент затронуть критически важные для бизнеса системы?
        -   Предлагаются ли какие-либо меры по устранению последствий?
        -   Сколько систем пострадало?
        -   Используется ли эксплойт в реальных условиях?
        -   Обладает ли эксплойт какими-либо возможностями, свойственными червям?

    Последние два вопроса могут указывать на уровень сложности злоумышленника.

    Как вы можете себе представить, инциденты с высоким уровнем воздействия будут обрабатываться оперативно, а инциденты с большим количеством затронутых систем подлежат эскалации.

    ++++++++++++++++++++++++++++++++++++++++++++
    + Incident Confidentiality & Communication +
    ++++++++++++++++++++++++++++++++++++++++++++

    Инциденты – это очень конфиденциальные темы, и поэтому вся собранная информация должна храниться только по принципу служебной необходимости, если иное не предписано действующим законодательством или решением руководства.
    Для этого есть несколько причин.
    Злоумышленник может быть, например, сотрудником компании, или, если произошло нарушение, информировать внутренние и внешние стороны должно назначенное лицо в соответствии с рекомендациями юридического отдела.

    При начале расследования мы устанавливаем определённые ожидания и цели.
    Они часто включают в себя тип произошедшего инцидента, имеющиеся у нас источники доказательств и приблизительную оценку времени, необходимого команде для расследования.
    Кроме того, исходя из инцидента, мы устанавливаем ожидания относительно того, сможем ли мы раскрыть злоумышленника.
    Конечно, многое из вышеперечисленного может измениться по мере развития расследования и появления новых версий. Важно держать всех участников и руководство в курсе любых успехов и ожиданий.

Начиная расследование, мы стремимся понять, что и как произошло.
Для правильного и эффективного анализа данных, связанных с инцидентом, членам команды по его обработке необходимы глубокие технические знания и опыт в данной области.
Возникает вопрос: «Зачем нам знать, как произошёл инцидент? Почему бы просто не восстановить затронутые системы и не забыть об этом?».

Если мы не знаем, как произошёл инцидент или что именно было затронуто, то любые предпринятые нами меры по устранению последствий не гарантируют, что злоумышленник не сможет повторить свои действия для восстановления доступа.
С другой стороны, если мы точно знаем, как злоумышленник проник в систему, какие инструменты он использовал и какие системы были затронуты, то мы можем спланировать меры по устранению последствий так, чтобы этот путь атаки невозможно было повторить.

    +++++++++++++++++++++
    + The Investigation +
    +++++++++++++++++++++

    Расследование начинается на основе первоначально собранной (и ограниченной) информации, содержащей всю известную нам информацию об инциденте на данный момент.
    С этими начальными данными мы начнём трёхэтапный циклический процесс, который будет повторяться по мере развития расследования.
    Этот процесс включает в себя:

        -   Создание и использование индикаторов компрометации (IOC);
        -   Выявление новых зацепок и затронутых систем;
        -   Сбор и анализ данных из новых зацепок и затронутых систем.

        //////////////////////////////////
        /// Initial Investigation Data ///
        //////////////////////////////////

        Чтобы прийти к заключению, расследование должно основываться на достоверных версиях, выявленных не только на начальном этапе, но и на протяжении всего процесса расследования.
        Команда по расследованию инцидентов должна постоянно выявлять новые версии, а не концентрироваться исключительно на конкретном факте, например, на известном вредоносном инструменте.
        Сужение расследования до конкретного вида деятельности часто приводит к ограниченным результатам, преждевременным выводам и неполному пониманию общего воздействия.

        ////////////////////////////////
        /// Creation & Usage Of IOCs ///
        ////////////////////////////////

        Индикатор компрометации — это признак того, что инцидент произошёл.
        Индикаторы компрометации (IOC) документируются в структурированном виде, что отражает артефакты компрометации.
        Примерами IOC могут быть IP-адреса, хеш-значения файлов и имена файлов.
        Поскольку IOC так важны для расследования, были разработаны специальные языки, такие как OpenIOC, для их документирования и стандартного обмена ими.
        Другим широко используемым стандартом для IOC является Yara.
        Существует ряд бесплатных инструментов, например, редактор IOC от Mandiant, для создания или редактирования IOC.
        Используя эти языки, мы можем описывать и использовать артефакты, обнаруженные в ходе расследования инцидента.
        Мы можем даже получать IOC от третьих лиц, если известны злоумышленник или атака.

        Для использования IOC потребуется развернуть инструмент для получения/поиска IOC (собственный или сторонний, возможно, масштабируемый).
        Распространенным подходом является использование WMI или PowerShell для операций, связанных с IOC, в средах Windows.
        
        *** Внимание! В ходе расследования необходимо проявлять особую осторожность, чтобы предотвратить кэширование учётных данных наших высокопривилегированных пользователей при подключении к (потенциально) скомпрометированным системам (или вообще к любым системам).
            В частности, необходимо гарантировать, что используются только те протоколы подключения и инструменты, которые не кэшируют учётные данные при успешном входе в систему (например, WinRM).
            Входы в Windows с типом входа 3 (сетевой вход) обычно не кэшируют учётные данные на удалённых системах.
            Лучшим примером принципа «знай свои инструменты», который приходит на ум, является PsExec.
            Когда PsExec используется с явным указанием учётных данных, эти данные кэшируются на удалённой машине.
            Когда PsExec используется без учётных данных в сеансе текущего вошедшего в систему пользователя, учётные данные не кэшируются на удалённой машине.
            Это отличный пример того, как один и тот же инструмент оставляет разные следы, поэтому будьте внимательны.

        //////////////////////////////////////////////////////
        /// Identification Of New Leads & Impacted Systems ///
        //////////////////////////////////////////////////////

        После поиска индикаторов компрометации (IOC) вы ожидаете найти совпадения, которые выявят другие системы с теми же признаками компрометации.
        Эти совпадения могут быть не связаны напрямую с расследуемым нами инцидентом.
        Например, наш индикатор компрометации может быть слишком общим.
        Нам необходимо выявить и исключить ложные срабатывания.
        Мы также можем столкнуться с большим количеством совпадений.
        В этом случае следует определить приоритетные, на которых мы сосредоточимся, в идеале те, которые могут дать нам новые зацепки после потенциального криминалистического анализа.

        ////////////////////////////////////////////////////////////////////////
        /// Data Collection & Analysis From The New Leads & Impacted Systems ///
        ////////////////////////////////////////////////////////////////////////

        После того, как мы идентифицировали системы, содержащие наши IOC, нам необходимо собрать и сохранить состояние этих систем для дальнейшего анализа, чтобы выявить новые зацепки и/или ответить на вопросы расследования об инциденте.
        В зависимости от системы существует несколько подходов к тому, как и какие данные собирать.
        Иногда мы хотим провести «оперативный анализ» системы во время её работы, в то время как в других случаях нам может потребоваться остановить систему и затем выполнить анализ.
        
            -   Оперативное исследование
                Это наиболее распространённый подход, при котором мы собираем заранее определённый набор данных, обычно богатый артефактами, которые могут объяснить, что произошло с системой.
        
            -   Выключение/остановка системы
                Это непростое решение, когда речь идёт о сохранении ценной информации, поскольку во многих случаях большая часть артефактов хранится только в оперативной памяти компьютера и будет потеряна при его выключении.
        
        Независимо от выбранного нами подхода к сбору данных, крайне важно обеспечить минимальное взаимодействие с системой, чтобы избежать изменения каких-либо улик или артефактов.

        После того, как данные собраны, наступает время их анализа.
        Зачастую это самый трудоёмкий процесс во время инцидента.
        Анализ вредоносного ПО и экспертиза диска являются наиболее распространёнными видами исследований.
        Все вновь обнаруженные и подтверждённые данные добавляются в хронологию, которая постоянно обновляется.
        Также следует отметить, что экспертиза памяти становится всё более популярной и чрезвычайно важной при борьбе с продвинутыми атаками.

        Помните, что в процессе сбора данных необходимо отслеживать цепочку поставок, чтобы гарантировать, что исследуемые данные будут допустимы для суда в случае подачи иска против злоумышленника.

=====================================================================
* Containment, Eradication, & Recovery *
****************************************

Когда расследование завершено и мы понимаем тип инцидента и его влияние на бизнес (на основании всех собранных данных и информации, собранной на временной шкале), наступает время перейти к этапу локализации, чтобы не допустить нанесения большего ущерба инцидентом.

    +++++++++++++++
    + Containment +
    +++++++++++++++

    На этом этапе мы предпринимаем действия по предотвращению распространения инцидента.
    Мы разделяем действия на краткосрочное и долгосрочное сдерживание.
    Важно, чтобы действия по сдерживанию были скоординированы и выполнялись во всех системах одновременно.
    В противном случае мы рискуем сообщить злоумышленникам о нашей атаке, и в этом случае они могут изменить свои методы и инструменты, чтобы оставаться в данной среде.

        -   Short-term containment
            На этапе краткосрочного сдерживания предпринимаемые действия оставляют минимальное воздействие на системы, в которых они происходят.
            Некоторые из этих действий могут включать в себя размещение системы в отдельной/изолированной VLAN, отключение сетевого кабеля от системы(систем) или изменение DNS-имени C2 злоумышленника на систему, находящуюся под нашим контролем, или на несуществующую.
            Эти действия ограничивают ущерб и дают время для разработки более конкретной стратегии восстановления.
            Кроме того, поскольку мы сохраняем системы неизменными (насколько это возможно), у нас есть возможность сделать криминалистические снимки и сохранить улики, если это не было сделано в ходе расследования (это также называется резервным подэтапом этапа сдерживания).
            Если краткосрочные меры по сдерживанию требуют отключения системы, мы должны убедиться, что об этом уведомлен бизнес-подразделения и предоставлены соответствующие разрешения.

        -   Long-term containment
            В долгосрочных мерах по сдерживанию мы фокусируемся на постоянных действиях и изменениях.
            К ним могут относиться изменение паролей пользователей, применение правил межсетевого экрана, установка системы обнаружения вторжений на хост, применение системного исправления и отключение систем.
            При выполнении этих действий мы должны держать бизнес-подразделения и соответствующих заинтересованных лиц в курсе событий.
            Имейте в виду, что установка исправления в системе не означает, что инцидент исчерпан.
            Ликвидация, восстановление и действия после инцидента ещё не завершены.

    +++++++++++++++
    + Eradication +
    +++++++++++++++

    После локализации инцидента необходимо провести ликвидацию, чтобы устранить как первопричину инцидента, так и то, что от неё осталось, чтобы гарантировать отсутствие злоумышленника в системах и сети. 
    екоторые действия на этом этапе включают удаление обнаруженного вредоносного ПО из систем, восстановление некоторых систем и восстановление других из резервной копии.
    На этапе ликвидации мы можем расширить ранее выполненные меры по локализации, установив дополнительные исправления, которые не потребовались немедленно.
    Также, на этапе ликвидации часто выполняются дополнительные меры по укреплению системы (не только в затронутой системе, но и в некоторых случаях по всей сети).

    ++++++++++++
    + Recovery +
    ++++++++++++

    На этапе восстановления мы возвращаем системы в нормальный режим работы.
    Конечно, бизнесу необходимо убедиться, что система действительно работает должным образом и содержит все необходимые данные.
    После завершения проверки эти системы возвращаются в рабочую среду.
    Все восстановленные системы будут подвергаться тщательному журналированию и мониторингу после инцидента, поскольку скомпрометированные системы, как правило, снова становятся целями атаки, если злоумышленник восстанавливает доступ к среде в короткие сроки.
    Типичные подозрительные события, за которыми следует следить:

        -   Необычные входы в систему (например, учетные записи пользователей или служб, которые ранее не использовались);

        -   Необычные процессы;

        -   Изменения в реестре в местах, которые обычно изменяются вредоносным ПО;

    Этап восстановления после некоторых крупных инцидентов может занять несколько месяцев, поскольку он часто реализуется поэтапно.
    На ранних этапах основное внимание уделяется повышению общей безопасности для предотвращения будущих инцидентов за счет быстрого достижения результатов и устранения несложных задач.
    На последующих этапах основное внимание уделяется постоянным, долгосрочным изменениям для обеспечения максимальной безопасности организации.

=====================================================================
* Post-Incident Activity *
**************************

На этом этапе наша цель — задокументировать инцидент и улучшить наши возможности на основе извлеченных из него уроков.
Этот этап дает нам возможность осмыслить угрозу, поняв, что произошло, что мы сделали и как наши действия и действия сработали.
Эту информацию лучше всего собирать и анализировать на встрече со всеми заинтересованными сторонами, участвовавшими в инциденте.
Как правило, это происходит в течение нескольких дней после инцидента, когда отчет об инциденте уже подготовлен.

    +++++++++++++
    + Reporting +
    +++++++++++++

    Итоговый отчет является важной частью всего процесса.
    Полный отчет будет содержать ответы на такие вопросы, как:

        -   Что произошло и когда?
        -   Эффективность работы команды, занимающейся инцидентом, в отношении планов, инструкций, политик и процедур.
        -   Предоставила ли компания необходимую информацию и оперативно ли отреагировала, чтобы помочь эффективно справиться с инцидентом? Что можно улучшить?
        -   Какие действия были предприняты для локализации и устранения инцидента?
        -   Какие превентивные меры следует принять для предотвращения подобных инцидентов в будущем?
        -   Какие инструменты и ресурсы необходимы для выявления и анализа подобных инцидентов в будущем?
    
    Такие отчеты в конечном итоге могут предоставить нам измеримые результаты.
    Например, они могут дать нам информацию о том, сколько инцидентов было обработано, сколько времени команда потратила на каждый инцидент и какие действия были выполнены в процессе обработки.
    Кроме того, отчеты об инцидентах также служат справочным материалом для решения будущих событий аналогичного характера.
    В ситуациях, когда необходимо обратиться в суд, отчет об инциденте также будет использоваться в суде и в качестве источника для определения затрат и последствий инцидентов.

    Этот этап также отлично подходит для обучения новых членов команды, демонстрируя им, как с инцидентом справились более опытные коллеги.
    Команда также должна оценить необходимость обновления планов, инструкций, политик и процедур.
    В период после инцидента важно пересмотреть инструменты, обучение и готовность команды, а также общую структуру команды, не сосредотачиваясь только на документации и процессах.


=====================================================================
* Руководство *
***************

Если использовать машину от HTB, то сперва надо запустить данную комнаду, чтобы скачать и распокавать все необходимые pcap файлы

	<usern_name>@<host_name>$ wget -O file.zip 'https://academy.hackthebox.com/storage/resources/pcap_files.zip' && mkdir tempdir && unzip file.zip -d tempdir && mkdir -p pcaps && mv tempdir/Intermediate_Network_Traffic_Analysis/* pcaps/ && rm -r tempdir file.zip

Удобнее всего просматривать PCAP-files используя Wireshark
Однако, в целях практики и выбработки навыков использования CLI-based tools мы будем использовать такие утилиты как tcpdump

=====================================================================
* Легенда *
***********

Атаки Time-to-Live в основном используются злоумышленниками как средство уклонения.
По сути, злоумышленник намеренно устанавливает очень низкий TTL для своих IP-пакетов, чтобы попытаться обойти межсетевые экраны, системы IDS и IPS.
Они работают следующим образом:

	1)	Злоумышленник создает IP-пакет с намеренно низким значением TTL (1, 2, 3 и т. д.).

	2)	Через каждый хост, через который проходит этот пакет, это значение TTL будет уменьшаться на единицу, пока не достигнет нуля.

	3)	Достигнув нуля, этот пакет будет отброшен.
		Злоумышленник попытается отбросить этот пакет до того, как он достигнет брандмауэра или системы фильтрации, чтобы избежать обнаружения/контроля.

	4)	Когда срок действия пакетов истекает, маршрутизаторы на пути генерируют сообщения ICMP Time Exceeded и отправляют их обратно на исходный IP-адрес

=====================================================================
* Подготовка *
**************

Как такового, подготовительного этапа, не существует
Однако, мы можем реализовать элемент управления, который отбрасывает или фильтрует пакеты, которые не имеют достаточно высокого TTL.
Таким образом, мы можем предотвратить эти формы атак IP-пакетов

=====================================================================
* Анализ *
**********

	++++++++++++++++++++++++++++++++++++
	+ Finding Irregularities in IP TTL +
	++++++++++++++++++++++++++++++++++++

	Обнаружение этого в небольших количествах может быть сложным, но к счастью для нас, злоумышленники в большинстве случаев будут использовать манипуляцию ttl при сканировании портов.
	Сразу же мы можем заметить что-то вроде следующего:

		-	огромное количество пакетов с одного и того же IP
		-	порты запроса будут перечислятся по порядку
		-	для всех пакетов будет одинаково низкий TTL, который нехарактерно низкий для подобного рода запросов

	Чтобы посмотреть какие пакеты содержат крайне низкий TTL и не относятся к внутренним мультикастовым протоколам, можно использовать следующие фильтры

		-	ip.ttl < #
			Отфильтровывает пакеты у которых TTL ниже 5

		-	!pim && !ospf
			Отфильтровывает пакеты, которые не относятся к сетевым протоколам PIM и OSPF

		-	!(vrrp || carp)
			Отфильтровывает пакеты, которые не относятся к протоколам вартуального IP-адреса маршрутизатора VRRP или CARP

	Ну или все вместе

		-	(ip.dst != 224.0.0.0/4 && ip.ttl < 5 && !pim && !ospf) || (ip.dst == 224.0.0.0/24 && ip.dst != 224.0.0.251 && ip.ttl != 1 && !(vrrp || carp))

=====================================================================
* Дополнительные Вопросы *
**************************

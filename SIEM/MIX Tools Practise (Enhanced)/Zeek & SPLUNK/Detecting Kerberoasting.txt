=====================================================================
* Введение *
************

Как Вы уже наверное значете, Zeek   -   обычно используется для тщательного изучения каждого бита трафика в сети, глубокого поиска любых признаков подозрительной или вредоносной активности.
Проще говоря, это такой же инструмент для анализа сетевого трафика, НО с другим (более узкоспециализированным) функционалом

Для подробной информции об общих и/или отличительных чертах Zeek от Wireshark, можно спросить ChatGPT или Google

!!! НО, очень часто Zeek используют для анализа пакетов собранных Wireshark (*.pcap)
    Поэтому, представленный ниже сценарий будет базироваться на анализе Zeek-ом некоторого *.pcap файла

Помимо взаимодействия с Zeek и Wireshark, будет также рассмотрено использование утилиты SPLUNK
Которая в свою очередь будет анализировать *.log файлы (это выжимка из *.pcap файла посредством Zeek/tShark) для отображения нужных результатов черех используемые фильтры

!!! Так как SPLUNK не работает на прямую с файлами типа *.pcap, то я КРАЙНЕ НАСТОЯТЕЛЬНО рекомендую ознакомиться с инструкцией по загрузки *.log файлов (каталогов) в базу данных SPLUNK

В данной презентации *.pcap файл уже был распарсен Zeek и все сформированные файлы были загружены в базу данных SPLUNK
Связанные материалы:

    -   PCAP-file           sharphound.pcap
    -   Splunk Index:       sharphound
    -   Splunk Sourcetupe:  bro:kerberos:json

Также перед оптимизацие фильтра, сперва рекомендую провести SPLUNK анализ без каких-либо уточняющих параметров
Это позволит увидеть вам название используемых полей-заголовков, которые мотом можно будет использовать для более тонкой настройки фильтрации

=====================================================================
* Detecting Kerberoasting *
***************************

В 2016 году появилось несколько сообщений в блогах и статей, в которых обсуждалась тактика запроса учетных записей Service Principal Name (SPN) и соответствующих им билетов
Позже, данная атака стала известна как Kerberoasting.
Обладая всего одной законной учетной записью пользователя и ее паролем, злоумышленник может получить билеты SPN и попытаться взломать их в автономном режиме.

После изучения многочисленных ресурсов по Kerberoasting становится очевидным, что RC4 используется для шифрования билетов за кулисами.
Мы будем использовать эту основу в качестве точки обнаружения в этом разделе.

Вот подробное описание атаки    -   https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting

Теперь давайте рассмотрим, как можно определить Kerberoasting с помощью Splunk и Zeek logs

    index="sharphound" sourcetype="bro:kerberos:json" request_type=TGS cipher="rc4-hmac"  forwardable="true" renewable="true"
        | table _time, id.orig_h, id.resp_h, request_type, cipher, forwardable, renewable, client, service
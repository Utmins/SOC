=====================================================================
* Введение *
************

Это пошаговое руководство, цель которой — продемонстрировать проблему, а не подробно описать атаку

Однако, дам один полезнй совет  -   если Вы застряли на каком-то этапе, так как фильтр, который Вы используете не дает нужного ответа, то просто удалите его, НО оставьте только те моменты в которых Вы полностью усовершенствованный
К примеру, Вам надо найти сервис, который был отакован скопроментированным полователем, но используемый фильтр, который вывел Вас на скопроментированного пользователя, не отображает нужную Вам информацию
Тогда, Вам надо удалить все, но оставить только index, username, soureimage (если используете), earliest/latest (если точно уверены во временном диапозоне)
И уже вычленять информацию из предоставленного результата
Более того, желательно знать значение EvenCode or EventID, но на крайний случай спросить интеренет

    +++++++++++++++++++++
    + Password Spraying +
    +++++++++++++++++++++

    В отличие от традиционных атак методом подбора, когда злоумышленник пытается ввести несколько паролей для одной учетной записи пользователя, распыление паролей распределяет атаку по нескольким учетным записям, используя ограниченный набор часто используемых или легко угадываемых паролей.
    Основная цель — обойти политики блокировки учетных записей, обычно устанавливаемые организациями.
    Эти политики обычно блокируют учетную запись после определенного количества неудачных попыток входа в систему, чтобы помешать атакам методом подбора паролей на отдельные учетные записи.
    Таким образом распыление паролей снижает вероятность срабатывания блокировки учетных записей, поскольку каждая учетная запись пользователя получает только несколько попыток ввода пароля, что делает атаку менее заметной.

    Существет множет инструментов, которые применяют злоумышленники при атаках подобного рода
    А так как данная демонстрация сопряжена с системой Windows, то и в примере будет использована утилита для Active Directory Credentials
    Название данного инструмента    -   Spray (https://github.com/Greenwolf/Spray)
    *** Помимо самой утилиты (кстати написанной на Bash) понадобятся еще и файлы с именем и паролем
        Файл с паролями можно использовать любой, доступный в интеренете
        А вот файл с именами пользователей лучше генерировать на основе патерна создания логинов в исследуемой среде
        Но хотя можно воспользоваться и любым другим

    Вот примерная команда для использования данного инструмента
    *** Синтаксис команды может немного отличаться в зависимости от атакуемого портала

        <user_name>@<host_name>$ sudo ./spray.sh -<portal_name> <target_IP> <user_name_List> <password_List> <Attempts_Per_Lockout_Period> <Lockout_Period_I_nMinutes> <DOMAIN>

    +++++++++++++++++++++++++++++++++++++++++++++
    + Password Spraying Detection Opportunities +
    +++++++++++++++++++++++++++++++++++++++++++++

    Обнаружение распыления паролей через журналы Windows включает анализ и мониторинг определенных журналов событий для выявления закономерностей и аномалий, указывающих на такую ​​атаку.
    Распространенной закономерностью является несколько неудачных попыток входа с идентификатором события 4625 (Failed Logon) из разных учетных записей пользователей, но исходящих с одного и того же исходного IP-адреса в течение короткого промежутка времени.

    Другие журналы событий, которые могут помочь в обнаружении распыления паролей, включают:

        Event ID    ID Name                                         Error Code
        
        4768        Kerberos Invalid Users                          ErrorCode 0x6
        4768        Kerberos Disabled Users                         ErrorCode 0x12 
        4776        NTLM Invalid Users                              ErrorCode 0xC000006A
        4776        NTLM Wrong Password                             ErrorCode 0xC0000064
        4648        Authenticate Using Explicit Credentials         N/A
        4771        Kerberos Pre-Authentication Failed

    +++++++++++++++++++++++++++++++++++++++++++
    + Detecting Password Spraying With Splunk +
    +++++++++++++++++++++++++++++++++++++++++++

    Для выявления попыток распыления пароля посредством SPLUNK следует использовать следующий вариант запроса-фильтра

        index=main earliest=1690280680 latest=1690289489 source="WinEventLog:Security" EventCode=4625
        | bin span=15m _time
        | stats values(user) as Users, dc(user) as dc_user by src, Source_Network_Address, dest, EventCode, Failure_Reason
    
    Вот расшифровка фильтра:

        -   index, source and EventCode:
            Поиск начинается с выбора событий из основного индекса, где источником является WinEventLog:Security, а код события — 4625. 
            Этот код события представляет неудачные попытки входа в систему в журнале событий безопасности Windows.

        -   Time Range Filter
            Поиск ограничивает временной диапазон событий теми, которые происходят между временными метками Unix 1690280680 и 1690289489.
            Эти временные метки представляют самое раннее и самое позднее время, когда произошли события.

        -   bin span:
            Команда bin span используется для создания временных интервалов длительностью 15 минут для каждого события на основе поля _time.
            Этот шаг группирует события в 15-минутные интервалы, что может быть полезно для анализа шаблонов или тенденций с течением времени.

        -   stats:
            Ккоманда stats используется для агрегации событий на основе полей src, Source_Network_Address, dest, EventCode и Failure_Reason.
            Для каждой уникальной комбинации этих полей поиск вычисляет следующую статистику:

                *   values(user) as Users:
                    Все уникальные значения поля пользователя в каждой группе.

                *   dc(user) as dc_user:
                    Отдельное количество уникальных значений поля пользователя в каждой группе.
                    Это представляет собой количество разных пользователей, связанных с неудачными попытками входа в каждой группе.
=====================================================================
* Windows Event Logs *
**********************

Третья группа подсказак пригодится для работы с Журналами Событий Windows (Windows Event Logs)
Ниже приведен примерный (неполный) список полезных журналов событий Windows:

    +++++++++++++++++++++++
    + Windows System Logs +
    +++++++++++++++++++++++

        -   Event ID 1074: System Shutdown/Restart (выключение/перезапуск системы)
            Этот журнал событий указывает, когда и почему система была выключена или перезапущена.
            Отслеживая эти события, вы можете определить, происходят ли неожиданные выключения или перезапуски, потенциально выявляющие вредоносную активность, такую ​​как заражение вредоносным ПО или несанкционированный доступ пользователя.

        -   Event ID 6005: The Event log service was started (служба журнала событий была запущена)
            Этот журнал событий отмечает время запуска службы журнала событий.
            Это важная запись, так как она может означать загрузку системы, предоставляя отправную точку для исследования производительности системы или потенциальных инцидентов безопасности в этот период.
            Ее также можно использовать для обнаружения несанкционированных перезагрузок системы.

        -   Event ID 6006: The Event log service was stopped (служба журнала событий была остановлена)
            Этот журнал событий обозначает момент остановки службы журнала событий.
            Обычно это видно при выключении системы.
            Ненормальные или неожиданные появления этого события могут указывать на преднамеренное прерывание работы службы для сокрытия незаконной деятельности.
        
        -   Event ID 6013: Windows uptime (время бесперебойной работы Windows)
            Это событие происходит один раз в день и показывает время бесперебойной работы системы в секундах.
            Более короткое, чем ожидалось, время бесперебойной работы может означать, что система была перезагружена, что может означать потенциальное вторжение или несанкционированные действия в системе.

        -   Event ID 7040: Service status change (изменение состояния службы)
            Это событие указывает на изменение типа запуска службы, который может быть с ручного на автоматический или наоборот.
            Если тип запуска важной службы изменен, это может быть признаком несанкционированного вмешательства в систему.

    +++++++++++++++++++++++++
    + Windows Security Logs +
    +++++++++++++++++++++++++

        -   Event ID 1102: The audit log was cleared (журнал аудита очищен)
            Очистка журнала аудита часто является признаком попытки удалить доказательства вторжения или вредоносной активности.

        -   Event ID 1116: Antivirus malware detection (обнаружение вредоносного ПО антивирусом)
            Это событие особенно важно, поскольку оно регистрируется, когда Defender обнаруживает вредоносное ПО.
            Всплеск этих событий может указывать на целевую атаку или широко распространенное заражение вредоносным ПО.

        -   Event ID 1118: Antivirus remediation activity has started (активность антивирусного исправления начата)
            Это событие означает, что Defender начал процесс удаления или помещения в карантин обнаруженного вредоносного ПО.
            Важно отслеживать эти события, чтобы убедиться, что действия по исправлению выполнены успешно.

        -   Event ID 1119: Antivirus remediation activity has succeeded (активность антивирусного исправления выполнена успешно)
            Это событие означает, что процесс исправления обнаруженного вредоносного ПО выполнен успешно.
            Регулярный мониторинг этих событий поможет гарантировать, что выявленные угрозы будут эффективно нейтрализованы.

        -   Event ID 1120: Antivirus remediation activity has failed (Антивирусная операция по исправлению не удалась)
            Это событие является аналогом 1119 и указывает на то, что процесс исправления не удался.
            Эти события следует внимательно отслеживать и немедленно устранять, чтобы обеспечить эффективную нейтрализацию угроз.

        -   Event ID 4624: Successful Logon (Успешный вход в систему)
            Это событие регистрирует успешные события входа в систему.
            Эта информация жизненно важна для установления нормального поведения пользователя.
            Ненормальное поведение, такое как попытки входа в систему в неурочное время или из разных мест, может означать потенциальную угрозу безопасности.

        -   Event ID 4625: Failed Logon (Неудачный вход в систему)
            Это событие регистрирует неудачные попытки входа в систему
            Несколько неудачных попыток входа в систему могут означать атаку методом подбора.

        -   Event ID 4648: A logon was attempted using explicit credentials (Попытка входа в систему с использованием явных учетных данных)
            Это событие срабатывает, когда пользователь входит в систему с явными учетными данными для запуска программы.
            Аномалии в этих событиях входа в систему могут указывать на горизонтальное перемещение в сети, что является распространенным приемом, используемым злоумышленниками.
        
        -   Event ID 4656: A handle to an object was requested (запрошен дескриптор объекта)
            Это событие запускается при запросе дескриптора объекта (например, файла, раздела реестра или процесса).
            Это может быть полезным событием для обнаружения попыток доступа к конфиденциальным ресурсам.

        -   Event ID 4672: Special Privileges Assigned to a New Logon (назначены особые привилегии новому входу)
            Это событие регистрируется всякий раз, когда учетная запись входит в систему с привилегиями суперпользователя.
            Отслеживание этих событий помогает гарантировать, что привилегии суперпользователя не будут злоупотребляться или использоваться злонамеренно.

        -   Event ID 4698: A scheduled task was created (создано запланированное задание)
            Это событие запускается при создании запланированного задания.
            Мониторинг этого события может помочь обнаружить механизмы сохранения, поскольку злоумышленники часто используют запланированные задания для сохранения доступа и запуска вредоносного кода.

        -   Event ID 4700 & Event ID 4701: A scheduled task was enabled/disabled (запланированное задание было включено/отключено)
            Это регистрирует включение или отключение запланированного задания.
            Злоумышленники часто манипулируют запланированными заданиями для сохранения или запуска вредоносного кода, поэтому эти журналы могут предоставить ценную информацию о подозрительных действиях.
        
        -   Event ID 4702: A scheduled task was updated (запланированная задача обновлена)
            Подобно  Event ID 4698, это событие запускается при обновлении запланированной задачи.
            Мониторинг этих обновлений может помочь обнаружить изменения, которые могут означать злонамеренные намерения.

        -   Event ID 4719: System audit policy was changed (системная политика аудита была изменена)
            Это событие регистрирует изменения политики аудита на компьютере.
            Это может быть признаком того, что кто-то пытается скрыть свои следы, отключив аудит или изменив события, которые будут проверяться.

        -   Event ID 4738: A user account was changed (учетная запись пользователя была изменена)
            Это событие регистрирует любые изменения, внесенные в учетные записи пользователей, включая изменения привилегий, членства в группах и настроек учетной записи.
            Неожиданные изменения учетной записи могут быть признаком захвата учетной записи или внутренних угроз.

        -   Event ID 4771: Kerberos pre-authentication failed (предварительная аутентификация Kerberos не удалась)
            Это событие похоже на 4625 (неудачный вход в систему), но специально для аутентификации Kerberos.
            Необычное количество этих журналов может указывать на попытку злоумышленника взломать вашу службу Kerberos.
        
        -   Event ID 4776: The domain controller attempted to validate the credentials for an account (контроллер домена попытался проверить учетные данные для учетной записи)
            Это событие помогает отслеживать как успешные, так и неудачные попытки проверки учетных данных контроллером домена.
            Множественные неудачи могут указывать на атаку методом подбора.

        -   Event ID 5001: Antivirus real-time protection configuration has changed (изменилась конфигурация антивирусной защиты в реальном времени)
            Это событие указывает на то, что параметры защиты в реальном времени Defender были изменены.
            Несанкционированные изменения могут указывать на попытку отключить или подорвать функциональность Defender.

        -   Event ID 5140: A network share object was accessed (был получен доступ к сетевому ресурсу)
            Это событие регистрируется при каждом доступе к сетевому ресурсу.
            Это может иметь решающее значение для выявления несанкционированного доступа к сетевым ресурсам.

        -   Event ID 5142: A network share object was added (был добавлен объект сетевого ресурса)
            Это событие означает создание нового сетевого ресурса.
            Несанкционированные сетевые ресурсы могут использоваться для извлечения данных или распространения вредоносного ПО по сети.
        
        -   Event ID 5145: A network share object was checked to see whether client can be granted desired access (Объект сетевого общего доступа был проверен, чтобы узнать, может ли клиент получить желаемый доступ)
            Это событие указывает на то, что кто-то попытался получить доступ к сетевому ресурсу.
            Частые проверки такого рода могут указывать на то, что пользователь или вредоносная программа пытаются сопоставить сетевые ресурсы для будущих эксплойтов.

        -   Event ID 5157: The Windows Filtering Platform has blocked a connection (Платформа фильтрации Windows заблокировала подключение)
            Это регистрируется, когда платформа фильтрации Windows блокирует попытку подключения.
            Это может быть полезно для идентификации вредоносного трафика в вашей сети.

        -   Event ID 7045: A service was installed in the system (В системе была установлена ​​служба)
            Это событие указывает на внезапное появление неизвестных служб
            Внезапное появление неизвестных служб может указывать на установку вредоносного ПО, поскольку многие типы вредоносных программ устанавливают себя как службы.

    +++++++++++++++
    + Sysmon Logs +
    +++++++++++++++

        -   Event ID 1: Process creation
            Событие создания процесса предоставляет расширенную информацию о недавно созданном процессе.
            Полная командная строка предоставляет контекст выполнения процесса.
            Поле ProcessGUID является уникальным значением для этого процесса в домене, что упрощает корреляцию событий.
            Хэш представляет собой полный хэш файла с алгоритмами в поле HashType.
            Полезно для охоты на ненормальные иерархии родительских и дочерних процессов

        -   Event ID 2: A process changed a file creation time
            Событие изменения времени создания файла регистрируется, когда время создания файла явно изменяется процессом.
            Это событие помогает отслеживать реальное время создания файла.
            Злоумышленники могут изменить время создания файла бэкдора, чтобы он выглядел так, как будто он был установлен вместе с операционной системой.
            Обратите внимание, что многие процессы законно изменяют время создания файла; это не обязательно указывает на вредоносную активность.

        -   Event ID 3: Network connection
            Событие сетевого подключения регистрирует соединения TCP/UDP на машине.
            По умолчанию оно отключено. Каждое соединение связано с процессом через поля ProcessId и ProcessGuid.
            Событие также содержит имена исходного и целевого хостов, IP-адреса, номера портов и статус IPv6.

        -   Event ID 4: Sysmon service state changed
            Событие изменения состояния службы сообщает о состоянии службы Sysmon (запущена или остановлена).
            Может быть полезным, если злоумышленники попытаются остановить Sysmon, хотя большинство этих событий, скорее всего, безвредны и информационны, учитывая частые законные запуски и остановки Sysmon

        -   Event ID 5: Process terminated
            Событие завершения процесса сообщает о завершении процесса.
            Это может помочь нам обнаружить, когда злоумышленники завершают ключевые процессы или используют жертвенные.
            Например, Cobalt Strike часто порождает временные процессы, такие как werfault, завершение которых будет регистрироваться здесь, а также создание в ID 1.
            Оно предоставляет UtcTime, ProcessGuid и ProcessId процесса.

        -   Event ID 6: Driver loaded
            Событие загрузки драйвера предоставляет информацию о загрузке драйвера в систему.
            Предоставляются настроенные хеши, а также информация о подписи.
            Подпись создается асинхронно из соображений производительности и указывает, был ли файл удален после загрузки.

        -   Event ID 7: Image loaded
            Событие загрузки образа регистрируется, когда модуль загружается в определенный процесс.
            Оно указывает процесс, в котором загружен модуль, хеши и информацию о подписи.
            Позволяет нам отслеживать загрузки dll, что удобно для обнаружения захватов DLL.
            Это событие по умолчанию отключено и должно быть настроено с помощью параметра «–l».
            Подпись создается асинхронно из соображений производительности и указывает, был ли файл удален после загрузки.
            Это событие следует настраивать тщательно, так как мониторинг всех событий загрузки образа приведет к созданию значительного объема журналов.

        -   Event ID 8: CreateRemoteThread
            Событие CreateRemoteThread обнаруживает, когда процесс создает поток в другом процессе.
            Этот метод используется вредоносным ПО для внедрения кода и сокрытия в других процессах.
            Событие указывает исходный и целевой процессы (source and target process).
            Оно предоставляет информацию о коде, который будет запущен в новом потоке:
                -   StartAddress
                -   StartModule
                -   StartFunction.
            Обратите внимание, что поля StartModule и StartFunction выводятся, они могут быть пустыми, если начальный адрес находится вне загруженных модулей или известных экспортированных функций.

        -   Event ID 9: RawAccessRead
            Событие RawAccessRead обнаруживает, когда процесс выполняет операции чтения с диска, используя обозначение \\.\.
            Этот метод часто используется вредоносным ПО для извлечения данных из файлов, которые заблокированы для чтения, а также для обхода инструментов аудита доступа к файлам.
            Событие указывает исходный процесс и целевое устройство.

        -   Event ID 10: ProcessAccess
            Событие доступа к процессу сообщает, когда процесс открывает другой процесс, операция, которая часто сопровождается запросами информации или чтением и записью адресного пространства целевого процесса.
            Это позволяет обнаруживать хакерские инструменты, которые считывают содержимое памяти процессов, таких как Local Security Authority (Lsass.exe), чтобы украсть учетные данные для использования в атаках Pass-the-Hash.
            полезно для обнаружения удаленного внедрения кода и дампа памяти, поскольку регистрирует, когда создаются дескрипторы процессов.
            Включение этого события может генерировать значительные объемы журналирования, если активны диагностические утилиты, которые многократно открывают процессы для запроса их состояния, поэтому обычно это следует делать только с фильтрами, которые удаляют ожидаемые доступы.

        -   Event ID 11: FileCreate
            Операции создания файлов регистрируются, когда файл создается или перезаписывается.
            Это событие полезно для мониторинга мест автозапуска, таких как папка «Автозагрузка», а также временных и загрузочных каталогов, которые являются обычными местами, куда вредоносное ПО попадает во время первоначального заражения.

        -   Event ID 12: RegistryEvent (создание и удаление объекта)
            Операции создания и удаления ключей и значений реестра сопоставляются с этим типом событий, что может быть полезно для мониторинга изменений в расположениях автозапуска реестра или определенных модификаций реестра вредоносных программ.

            Sysmon использует сокращенные версии имен корневых ключей реестра со следующими сопоставлениями:

                Имя ключа                                   Сокращение
                HKEY_LOCAL_MACHINE                          HKLM
                HKEY_USERS                                  HKU
                HKEY_LOCAL_MACHINE\System\ControlSet00x     HKLM\System\CurrentControlSet
                HKEY_LOCAL_MACHINE\Classes                  HKCR
        
        -   Event ID 13: RegistryEvent (набор значений)
            Этот тип событий реестра определяет изменения значений реестра.
            Событие записывает значение, записанное для значений реестра типа DWORD и QWORD.

        -   Event ID 14: RegistryEvent (переименование ключа и значения)
            Операции переименования ключа и значения реестра сопоставляются с этим типом события, записывая новое имя ключа или значения, которое было переименовано.
        
        -   Event ID 15: FileCreateStreamHash
            Это событие регистрируется при создании именованного потока файлов и генерирует события, которые регистрируют хэш содержимого файла, которому назначен поток (неименованный поток), а также содержимое именованного потока.
            Относится к потокам файлов и "Mark of the Web", относящимся к внешним загрузкам,
            Существуют варианты вредоносного ПО, которые сбрасывают свои исполняемые файлы или параметры конфигурации через загрузки браузера, и это событие нацелено на захват этого на основе присоединения браузером потока Zone.Identifier «метки веба».

        -   Event ID 16: ServiceConfigurationChange
            Это событие регистрирует изменения в конфигурации Sysmon, например, при обновлении правил фильтрации.
            Полезно для обнаружения несанкционированного доступа.

        -   Event ID 17: PipeEvent (Pipe Created)
            Это событие генерируется при создании именованного канала.
            Они могут помочь наблюдать за попытками межпроцессного взаимодействия вредоносного ПО, использованием PsExec и боковым перемещением SMB.

        -   Event ID 18: PipeEvent (Pipe Connected)
            Это событие регистрируется при установлении соединения именованного канала между клиентом и сервером.

        -   Event ID 19: WmiEvent (обнаружена активность WmiEventFilter)
            Когда регистрируется фильтр событий WMI, что является методом, используемым вредоносным ПО для выполнения, это событие регистрирует пространство имен WMI, имя фильтра и выражение фильтра.

        -   Event ID 20: WmiEvent (обнаружена активность WmiEventConsumer)
            Это событие регистрирует регистрацию потребителей WMI, записывая имя потребителя, журнал и назначение.

        -   Event ID 21: WmiEvent (обнаружена активность WmiEventConsumerToFilter)
            Когда потребитель привязывается к фильтру, это событие регистрирует имя потребителя и путь фильтра.

        -   Event ID 22: DNSEvent (DNS-запрос)
            Это событие генерируется, когда процесс выполняет DNS-запрос, независимо от того, был ли результат успешным или неудачным, кэшированным или нет.
            Может быть полезно для мониторинга разрешений маяков и маяков DNS
            Телеметрия для этого события была добавлена ​​для Windows 8.1, поэтому она недоступна в Windows 7 и более ранних версиях.

        -   Event ID 23: FileDelete (архивное удаление файла)
            Файл был удален.
            Может дать представление о том, очистил ли злоумышленник свое вредоносное ПО, удалил ли важные файлы или, возможно, пытался ли он провести атаку с целью вымогательства.
            Помимо регистрации события, удаленный файл также сохраняется в ArchiveDirectory (по умолчанию это C:\Sysmon).
            В нормальных рабочих условиях этот каталог может вырасти до необоснованных размеров — см. событие ID 26: FileDeleteDetected для похожего поведения, но без сохранения удаленных файлов.

        -   Event ID 24: ClipboardChange (новое содержимое в буфере обмена)
            Это событие генерируется при изменении содержимого системного буфера обмена.

        -   Event ID 25: ProcessTampering (изменение образа процесса)
            Это событие генерируется при обнаружении методов сокрытия процесса, таких как «hollow» или «herpaderp».
            Действует как мини-фильтр оповещений AV

        -   Event ID 26: FileDeleteDetected (регистрируется удаление файла)
            Файл был удален.

        -   Event ID 27: FileBlockExecutable
            Это событие генерируется, когда Sysmon обнаруживает и блокирует создание исполняемых файлов (формат PE).

        -   Event ID 28: FileBlockShredding
            Это событие генерируется, когда Sysmon обнаруживает и блокирует уничтожение файлов такими инструментами, как SDelete.

        -   Event ID 29: FileExecutableDetected
            Это событие генерируется, когда Sysmon обнаруживает создание нового исполняемого файла (формат PE).

        -   Event ID 255: Ошибка
            Это событие генерируется, когда в Sysmon произошла ошибка.
            Они могут произойти, если система находится под большой нагрузкой и определенные задачи не могут быть выполнены или в службе Sysmon есть ошибка, или даже если не выполнены определенные условия безопасности и целостности.
            Вы можете сообщить о любых ошибках на форуме Sysinternals или в Twitter (@markrussinovich).
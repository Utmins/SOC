Важно подчеркнуть, что в Windows есть несколько типов входа (как пользователи входят в систему):
Типы входа необходимо знать, потому что они оставляют «след» в системе(ах), к которой осуществляется доступ.
Этот след — это используемые имя пользователя и пароль.
Как правило, типы входа, за исключением «с'Network logon, type 3», оставляют учетные данные в системе, прошедшей аутентификацию и подключенной к ней.
Полный список типов входа в системах Microsoft можно найти здесь	-	https://learn.microsoft.com/en-us/windows-server/identity/securing-privileged-access/reference-tools-logon-types

Чтобы взаимодействовать с Active Directory, которая работает на контроллерах домена, мы должны говорить на ее языке, LDAP.
Любой запрос происходит путем отправки специально созданного сообщения в LDAP на контроллер домена, например, для получения информации о пользователе и членстве в группе.
Для взаимодействия с Active Directory локально на контроллере домена или удаленно с другого компьютерного объекта Microsoft разработала Remote Server Administration Tools (RSAT).

Важные сетевые порты в любой среде Windows включают (запоминание их чрезвычайно полезно):

	-	53					DNS
	-	88					Kerberos
	-	135					WMI/RPC
	-	137-139 и 445		SMB
	-	389 и 636			LDAP
	-	3389				RDP
	-	5985 и 5896			PowerShell Remoting (WinRM)

В Active Directory любые дополнительные роли, службы и функции, которые «добавляются» поверх того, что поставляется из коробки, должны быть классифицированы.
Эта классификация необходима для того, чтобы гарантировать, что мы устанавливаем уровень, для которой служба, в случае ее компрометации, представляет риск эскалации по отношению к остальной части Active Directory.
В этом представлении дизайна нам необходимо гарантировать, что любая служба, допускающая прямую (или косвенную) эскалацию, обрабатывается так же, как если бы это был контроллер домена/Active Directory.
Active Directory огромен, сложен и насыщен различными функциями, которые в случае компрометанции создают потенциальные риски для последующей эскалации привелегий.
Если злоумышленник получит права администратора для этих служб, он косвенно получит возможность повысить свои привилегии до прав администратора всего леса.

Однако Active Directory имеет ограничения.
К сожалению, эти ограничения являются «слабым» местом и расширяют поверхность атаки
Некоторые из них вызваны сложностью, другие — дизайном, а некоторые — устаревшими функциями и обратной совместимостью.
Для полноты картины ниже приведены три примера каждого из них:

	-	Complexity (Сложность)
		Самый простой пример — определение членов вложенных групп.
		Легко запутаться, разбираясь, кто является членом группы, членом другой группы и членом еще одной группы.
		Хотя вы можете подумать, что эта цепочка в конечном итоге заканчивается, во многих средах каждый «пользователь домена» косвенно является членом «администраторов домена»

	-	Design (Конструкция/Архитектура)
		Active Directory позволяет удаленно управлять машинами с помощью объектов групповой политики (GPO).
		В дополнение к этому, AD хранит объекты групповой политики в уникальном сетевом ресурсе/папке под названием SYSVOL, откуда все устройства, присоединенные к домену, извлекают примененные к ним настройки.
		Поскольку это сетевая папка, клиенты получают доступ к SYSVOL через протокол SMB и передают сохраненную информацию.
		Таким образом, чтобы машина могла использовать новые настройки, она должна вызвать контроллер домена и извлечь настройки из SYSVOL
		Это систематический процесс, который по умолчанию происходит каждые 90 минут.
		Из-за этого, каждое устройство должно иметь контроллер домена «в поле зрения», чтобы извлечь эти данные.
		Недостатком этого является то, что протокол SMB также допускает выполнение кода (удаленная командная оболочка, где команды будут выполняться на контроллере домена)
		Поэтому, пока у нас есть набор действительных учетных данных, мы можем последовательно выполнять код через SMB на контроллерах домена удаленно.
		Этот порт/протокол доступен всем машинам по отношению к контроллерам домена. (Кроме того, SMB (как правило, Active Directory) не очень подходит для концепций нулевого доверия.)
		Если у злоумышленника есть хороший набор привилегированных учетных данных, то по крайней мере он может выполнить код от имени этой учетной записи на контроллерах домена через SMB

	-	Legacy (Устаревшие)
		Windows не является безопасной по умолчанию.
		Устаревшим примером является то, что Windows поставляется с широковещательными — DNS-подобными протоколами NetBIOS и LLMNR, включенными по умолчанию.
		Эти протоколы предназначены для использования в случае сбоя DNS.
		Однако они активны даже тогда, когда это не так.
		Из-за своей конструкции они транслируют учетные данные пользователя по сети (имена пользователей, пароли, хэши паролей), что может эффективно предоставлять привилегированные учетные данные любому, кто прослушивает сеть, просто находясь там.
		Данный пример демонстрирует злоупотребление захватом учетных данных по сети	-	https://www.a2secure.com/blog-en/how-to-use-responder-to-capture-netntlm-and-grab-a-shell/